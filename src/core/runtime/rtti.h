// ======================================================================================
// File         : rtti.h
// Author       : Wu Jie 
// Last Change  : 11/26/2010 | 11:32:20 AM | Friday,November
// Description  : 
// ======================================================================================

// #################################################################################
#ifndef RTTI_H_1290742341
#define RTTI_H_1290742341
// #################################################################################

// ######################### 
#ifdef __cplusplus
extern "C" { 
#endif
// ######################### 

///////////////////////////////////////////////////////////////////////////////
// includes
///////////////////////////////////////////////////////////////////////////////

#include "prop.h"

///////////////////////////////////////////////////////////////////////////////
// struct
///////////////////////////////////////////////////////////////////////////////

typedef struct ex_rtti_t {
    struct ex_rtti_t* _super;
    strid_t _classid;
    ex_prop_t* _props;
    uint32 _prop_count;
} ex_rtti_t;

///////////////////////////////////////////////////////////////////////////////
// function
///////////////////////////////////////////////////////////////////////////////

// ------------------------------------------------------------------ 
// Desc: 
// ------------------------------------------------------------------ 

// success: 0
// already inited: 1
// failed: -1
extern int ex_rtti_init ();
extern void ex_rtti_deinit ();
extern bool ex_rtti_initialized ();

// ------------------------------------------------------------------ 
// Desc: 
// ------------------------------------------------------------------ 

extern ex_rtti_t* ex_rtti_register_class ( strid_t _classID, ex_rtti_t* _super );

// ------------------------------------------------------------------ 
// Desc: 
// ------------------------------------------------------------------ 

extern void ex_rtti_register_properties ( ex_rtti_t* _info, const ex_prop_t* _props, uint32 _count );

// ------------------------------------------------------------------ 
// Desc: 
// ------------------------------------------------------------------ 

extern ex_rtti_t* ex_rtti_get ( strid_t _classID );

// ------------------------------------------------------------------ 
// Desc: 
// ------------------------------------------------------------------ 

static inline const char* ex_rtti_classname ( const ex_rtti_t* _info ) { 
    return ex_strid_to_cstr(_info->_classid); 
} 

// ------------------------------------------------------------------ 
// Desc: 
// ------------------------------------------------------------------ 

static inline strid_t ex_rtti_classid ( const ex_rtti_t* _info ) { 
    return _info->_classid; 
}

// ------------------------------------------------------------------ 
// Desc: 
// ------------------------------------------------------------------ 

static inline ex_rtti_t* ex_rtti_super ( const ex_rtti_t* _info ) { 
    return _info->_super; 
}

// ------------------------------------------------------------------ 
// Desc: 
// ------------------------------------------------------------------ 

static inline bool ex_rtti_classof ( const ex_rtti_t* _myclass, const ex_rtti_t* _yourclass ) { 
    return _myclass->_classid == _yourclass->_classid;
}

// ------------------------------------------------------------------ 
// Desc: 
// ------------------------------------------------------------------ 

extern bool ex_rtti_childof ( const ex_rtti_t* _myclass, const ex_rtti_t* _superclass );

// ------------------------------------------------------------------ 
// Desc: 
// ------------------------------------------------------------------ 

static inline bool ex_rtti_superof ( const ex_rtti_t* _myclass, const ex_rtti_t* _subclass ) { 
    return ex_rtti_childof( _subclass, _myclass );
}

// ------------------------------------------------------------------ 
// Desc: 
// ------------------------------------------------------------------ 

static inline bool ex_rtti_isa ( const ex_rtti_t* _myclass, const ex_rtti_t* _class ) { 
    return ex_rtti_classof(_myclass,_class) || ex_rtti_childof(_myclass,_class);
}

// ######################### 
#ifdef __cplusplus
} // end extern C 
#endif
// ######################### 

// #################################################################################
#endif // END RTTI_H_1290742341
// #################################################################################


