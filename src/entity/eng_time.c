// ======================================================================================
// File         : eng_time.c
// Author       : Wu Jie 
// Last Change  : 01/06/2011 | 23:40:02 PM | Thursday,January
// Description  : 
// ======================================================================================

///////////////////////////////////////////////////////////////////////////////
// includes
///////////////////////////////////////////////////////////////////////////////

#include "exsdk.h"
#include "eng_time.h"

///////////////////////////////////////////////////////////////////////////////
// private
///////////////////////////////////////////////////////////////////////////////

static uint32 __timer_engine_start = 0;
static uint32 __timer_world_loaded = 0;
static uint32 __timer_frame_start = 0;

static float __time = 0.0f;
static float __worldtime = 0.0f;
static float __realtime = 0.0f;
static float __dt = 0.0f;
static float __dt_physics = 1.0f;
static float __time_scale = 1.0f;

// ------------------------------------------------------------------ 
// Desc: 
// ------------------------------------------------------------------ 

void __eng_time_start () {
    uint32 now = ex_timer_get_ticks();
    __timer_engine_start = now; 
    __timer_frame_start = now;
    __time = (float)now/1000.0f;
}

// ------------------------------------------------------------------ 
// Desc: 
// ------------------------------------------------------------------ 

void __world_time_start () {
    uint32 now = ex_timer_get_ticks();
    __timer_world_loaded = now;
    __worldtime = (float)now/1000.0f;
}

// ------------------------------------------------------------------ 
// Desc: 
// ------------------------------------------------------------------ 

void __eng_time_tick () {
    uint32 now = ex_timer_get_ticks();

    __dt = (float)(now-__timer_frame_start)/1000.0f * __time_scale;
    __realtime = (float)(now-__timer_engine_start)/1000.0f;
    __time += __dt;
    __worldtime += __dt;
    __timer_frame_start = now;
}

///////////////////////////////////////////////////////////////////////////////
// public defines
///////////////////////////////////////////////////////////////////////////////

// ------------------------------------------------------------------ 
// Desc: 
// ------------------------------------------------------------------ 

float ex_time () { return __time; }

// ------------------------------------------------------------------ 
// Desc: 
// ------------------------------------------------------------------ 

float ex_worldtime () { return __worldtime; }

// ------------------------------------------------------------------ 
// Desc: 
// ------------------------------------------------------------------ 

float ex_realtime () { return __realtime; }

// ------------------------------------------------------------------ 
// Desc: 
// ------------------------------------------------------------------ 

float ex_dt () { return __dt; }

// ------------------------------------------------------------------ 
// Desc: 
// ------------------------------------------------------------------ 

float ex_dt_physics () { return __dt_physics; }

// ------------------------------------------------------------------ 
// Desc: 
// ------------------------------------------------------------------ 

float ex_time_scale () { return __time_scale; }

// ------------------------------------------------------------------ 
// Desc: 
// ------------------------------------------------------------------ 

void ex_set_time_scale ( float _scale ) { __time_scale = _scale; }
